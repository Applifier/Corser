#!/usr/bin/env node
var argv, http, corser, server, requestHeaders, responseHeaders, corserRequestListener, proxerRequestListener;

argv = require("optimist").default("port", 1337).alias("p", "port").argv;
http = require("http");
corser = require("../lib/corser");
proxer = require("../lib/proxer");

requestHeaders = corser.simpleRequestHeaders.concat(["Range"]);
responseHeaders = corser.simpleResponseHeaders;

corserRequestListener = corser.create({
    requestHeaders: requestHeaders,
    responseHeaders: responseHeaders
});

proxerRequestListener = proxer.create({
    requestHeaders: requestHeaders,
    responseHeaders: responseHeaders
});

server = http.createServer(function (req, res) {
    corserRequestListener(req, res, function () {
        proxerRequestListener(req, res);
    });
});
server.listen(argv.port);
console.log("Corser running on port " + argv.port + ".");

// vim: ft=javascript
